# sros and src communication

## defect

### sros 给src发送动作任务，没有成功和失败的状态返回
sros给src发动作任务时，只要下发了，sros就任务src接受成功过来，而且开始正常执行了。

如：当给不存在顶升机构的车发送顶升，src实际上没有启动任务。而sros则认为src正在执行顶升动作




### src 状态机梳理
具体问题：取消任务后，系统状态一直停留在：遇到障碍,减速..

该问题已查明，是由于：

1. 当时正在使用debug_loop的功能；
2. debug_loop在启动新任务时没有检查当前是否处于手动控制状态；
3. 用户在任务执行过程中点击了停止手动控制；
4. SRC在停止手动控制的同时也停止了路径任务；
5. SRC停止路径任务后上传的当前执行路径编号为0；
6. 避障模块发现当前执行路径编号为0，无法正确进行避障判断；

正常情况下，系统处于手动控制状态时是无法启动新任务的，debug_loop因为是调试功能，所以没有做任何前置判断，这是问题发生的主要原因。

后续处理：

1. 在SROS v4.8.0中弃用debug_loop功能，使用matrix中的mission功能替换；（彭佳立）
2. SRC状态机梳理，明确状态流转过程；（李洪祥）




### sros无法获取src的手动控制状态，导致有时候src处于自动控制模式，但是sros任务其还处于手动控制模式
具体问题：

画地图时，当急停触发后，解除急停，src处于非手动控制状态，而sros任务src处于手动控制模式，导致无法手动控制，从而导致无法继续绘图


## 新协议需要修改的地方
- **通信单位约定**： 长度单位：0.1mm 角度单位：万分之一弧度，[0, 2 * π * 10000)，逆时针为正方向。 坐标系：左手系; 所有要去除寄存器0x252B